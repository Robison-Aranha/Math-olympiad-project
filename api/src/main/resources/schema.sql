drop table if exists permissao cascade;
drop table if exists usuario cascade;
drop table if exists quest_item cascade;
drop table if exists personagem_item cascade;
drop table if exists usuario_personagem cascade;
drop table if exists personagem_atributo cascade;
drop table if exists classe_atributo cascade;
drop table if exists atributo cascade;
drop table if exists quest cascade;
drop table if exists personagem cascade;
drop table if exists classe cascade;
drop table if exists item cascade;
drop type if exists CLA;
drop type if exists ITEM_TIPOS;
drop type if exists ATRIBUTOS;


create type CLA as enum ('CATADORES', 'HIGIENIZADORES');
create type ITEM_TIPOS as enum ('VIDA', 'FORCA', 'NIVEL', 'DESTREZA', 'ARMA', 'ARMADURA');
create type ATRIBUTOS as enum ('VIDA', 'FORCA', 'NIVEL', 'DESTREZA');

create table usuario (
	id bigint generated by default as identity not null,
	nome varchar(100) not null,
	senha varchar(100) not null,
	ativo BOOLEAN not null
);
alter table usuario add constraint pk_usuario primary key (id);
alter table usuario add constraint uk_usuario_nome unique (nome);


create table permissao (
	id bigint generated by default as identity not null,
	nome varchar(100) not null,
	usuario_id BIGINT not null
);
alter table permissao add constraint pk_permissao primary key (id);
alter table permissao add constraint uk_permissao unique (nome, usuario_id);
alter table permissao add constraint fk_permissao_usuario foreign key (usuario_id) references usuario;

create table atributo (
    id bigint generated by default as identity not null,
    atributo ATRIBUTO not null,
    valor numeric default 0.0
);
alter table atributo add constraint pk_atributo primary key (id);

create table classe (
    id bigint generated by default as identity not null,
    imagem text not null,
    cla CLA not null,
    descricao text not null,
);
alter table classe add constraint pk_classe primary key (id);

create table classe_atributo (
    id_classe bigint not null,
    id_atributo bigint not null
);
alter table classe_atributo add constraint fk_classe_atributo_id_classe foreign key (id_classe) references classe;
alter table classe_atributo add constraint fk_classe_atributo_id_atributo foreign key (id_atributo) references atributo;


create table quest (
    id bigint generated by default as identity not null,
    tempo Numeric not null,
    imagem text not null,
    descricao text not null
);

alter table quest add constraint pk_quest primary key (id);

create table personagem (
    id bigint generated by default as identity not null,
    nome varchar(100) not null,
    cla CLA not null,
    id_quest bigint,
    dinheiro numeric not null,
    id_classe bigint not null,
    termino_ultima_quest timestamp,
    vitorias int,
    derrotas int,
);
alter table personagem add constraint pk_personagem primary key (id);
alter table personagem add constraint fk_personagem_id_classe foreign key (id_classe) references classe;
alter table personagem add constraint fk_personagem_id_quest foreign key (id_quest) references quest;

create table personagem_atributo (
    id_personagem bigint not null,
    id_atributo bigint not null,
);

alter table personagem_atributo add constraint fk_personagem_atributo_id_personagem foreign key (id_personagem) references personagem;
alter table personagem_atributo add constraint fk_personagem_atributo_id_atributo foreign key (id_atributo) references atributo;


create table usuario_personagem (
    id_usuario bigint not null,
    id_personagem bigint not null
);
alter table usuario_personagem add constraint fk_usuario_personagem_id_usuario foreign key (id_usuario) references usuario;
alter table usuario_personagem add constraint fk_usuario_personagem_id_personagem foreign key (id_personagem) references personagem;

create table item (
    id bigint generated by default as identity not null,
    imagem text not null,
    preco numeric not null,
    nome varchar(100) not null,
    tipo ITEM_TIPOS not null,
    valor numeric not null,
    descricao text not null
);
alter table item add constraint pk_item primary key (id);

create table personagem_item (
    id_personagem bigint not null,
    id_item bigint not null
);

alter table personagem_item add constraint fk_usuario_item_id_personagem foreign key (id_personagem) references personagem;
alter table personagem_item add constraint fk_usuario_item_id_item foreign key (id_item) references item;


create table quest_item (
    id_quest bigint not null,
    id_item bigint not null
);

alter table quest_item add constraint foreign key (id_quest) references quest;
alter table quest_item add constraint foreign key (id_item) references item;


